{% extends "layout.peb" %}

{% block title %}{{ email.subject | default('(Sans sujet)') }} - UGE Webmail{% endblock %}

{% block content %}
<div class="mail-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
        <a href="/mail/{{ folder }}" class="btn btn-secondary btn-compose">â† Retour</a>
        
        <nav class="folder-nav">
            <a href="/mail/inbox" class="folder-link {% if folder == 'inbox' %}active{% endif %}">ğŸ“¥ BoÃ®te de rÃ©ception</a>
            <a href="/mail/outbox" class="folder-link {% if folder == 'outbox' %}active{% endif %}">ğŸ“¤ Messages envoyÃ©s</a>
            <a href="/mail/drafts" class="folder-link {% if folder == 'draft' %}active{% endif %}">ğŸ“ Brouillons</a>
            <a href="/mail/trash" class="folder-link {% if folder == 'trash' %}active{% endif %}">ğŸ—‘ï¸ Corbeille</a>
        </nav>
    </aside>
    
    <!-- Main content -->
    <div class="mail-content">
        <div class="email-view">
            <!-- Actions bar -->
            <div class="email-actions">
                {% if folder == "draft" %}
                <a href="/mail/edit/{{ email.id }}" class="btn btn-primary">âœï¸ Modifier</a>
                {% else %}
                <a href="/mail/compose?to={{ email.from }}&subject=Re: {{ email.subject }}&replyTo={{ folder }}/{{ email.id }}" 
                   class="btn btn-primary">â†©ï¸ RÃ©pondre</a>
                {% endif %}
                
                <form method="post" action="/mail/delete/{{ folder }}/{{ email.id }}" style="display: inline;">
                    <button type="submit" class="btn btn-danger" 
                            onclick="return confirm('{% if folder == 'trash' %}Supprimer dÃ©finitivement ?{% else %}DÃ©placer vers la corbeille ?{% endif %}')">
                        ğŸ—‘ï¸ {% if folder == "trash" %}Supprimer dÃ©finitivement{% else %}Supprimer{% endif %}
                    </button>
                </form>
                
                <!-- Tag toggles -->
                <div class="tag-actions">
                    <form method="post" action="/mail/tag/{{ folder }}/{{ email.id }}/important" style="display: inline;">
                        <button type="submit" class="btn btn-small {% if email.important %}btn-warning{% else %}btn-secondary{% endif %}">
                            â­ {% if email.important %}Retirer Important{% else %}Marquer Important{% endif %}
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Email header -->
            <div class="email-header-view">
                <h1>{{ email.subject | default('(Sans sujet)') }}</h1>
                
                <div class="email-meta">
                    <div class="meta-row">
                        <span class="meta-label">De :</span>
                        <span class="meta-value">{{ email.from }}</span>
                    </div>
                    <div class="meta-row">
                        <span class="meta-label">Ã€ :</span>
                        <span class="meta-value">{{ email.toAsString }}</span>
                    </div>
                    <div class="meta-row">
                        <span class="meta-label">Date :</span>
                        <span class="meta-value">{{ email.date }}</span>
                    </div>
                </div>
                
                <!-- Tags -->
                {% if email.tags is not empty %}
                <div class="email-tags-view">
                    {% for tag in email.tags %}
                    <span class="tag {% if tag == 'important' %}tag-important{% elseif tag == 'unread' %}tag-unread{% elseif tag == 'anonymous' %}tag-anonymous{% endif %}">
                        {{ tag }}
                    </span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            
            <!-- Email content -->
            <div class="email-body">
                <pre>{{ email.content }}</pre>
            </div>
            
            <!-- Attachments -->
            {% if email.attachments is not empty %}
            <div class="email-attachments">
                <h3>ğŸ“ PiÃ¨ces jointes ({{ email.attachments | length }})</h3>
                <ul class="attachment-list">
                    {% for attachment in email.attachments %}
                    <li class="attachment-item">
                        <a href="/mail/attachment/{{ attachment.sha256 }}/{{ attachment.filename }}" 
                           class="attachment-link" download>
                            ğŸ“„ {{ attachment.filename }}
                            <span class="attachment-size">({{ attachment.formattedSize }})</span>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
